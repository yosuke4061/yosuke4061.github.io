<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>クジラ形状生成コードの詳細解説</title>
</head>
<body>
    <h1>クジラ形状生成コードの詳細解説</h1>
    <p>このページでは、JavaScript関数 <code>createWhaleShape</code> の詳細な動作と、Three.jsを使用した3Dグラフィックスの生成について説明します。</p>
    
    <h2>関数のパラメータ</h2>
    <ul>
        <li><strong>scaleFactor</strong>: XYZデータのスケールを調整するための係数です。この係数により、読み込まれたデータの各座標が拡大または縮小されます。デフォルト値は35です。</li>
        <li><strong>transitionDuration</strong>: 形状の変化にかかる時間をミリ秒単位で指定します。この時間はアニメーションの長さを決定し、デフォルト値は5000ミリ秒（5秒）です。</li>
    </ul>

    <h2>処理の流れ</h2>
    <ol>
        <li><strong>ファイルの読み込み</strong>: <code>THREE.FileLoader</code> を使用して、XYZ形式のデータファイルを非同期に読み込みます。このファイルはクジラの3Dモデルの座標データを含んでいます。</li>
        <li><strong>データの解析</strong>: 読み込んだデータを行ごとに分割し、各行をさらに空白で分割してXYZ座標を取得します。取得した各座標には前述の <code>scaleFactor</code> が乗算され、実際の表示サイズが調整されます。</li>
        <li><strong>点のランダム配置</strong>: 元の点データに対してランダムな値を加えることで、点を新しい位置に配置します。これにより、初期状態では点群がランダムに散らばった状態で表示されます。</li>
        <li><strong>色の設定</strong>: 各点にランダムな色を設定します。色の生成には <code>THREE.Color</code> オブジェクトが使用され、RGB値がランダムに割り当てられます。</li>
        <li><strong>ジオメトリとマテリアルの作成</strong>: <code>THREE.BufferGeometry</code> を使用して点群のジオメトリを作成し、<code>THREE.PointsMaterial</code> を使用してマテリアルを設定します。このマテリアル設定には頂点色が使われ、点のサイズも指定されます。</li>
        <li><strong>シーンへの追加</strong>: 作成した点群オブジェクトをThree.jsのシーンに追加します。これにより、点群が3D空間に表示されるようになります。</li>
        <li><strong>アニメーションの適用</strong>: <code>TWEEN</code> ライブラリを使用して、ランダムに配置された点群を徐々に元のクジラの形状に移動させます。この遷移は <code>transitionDuration</code> で指定された時間で行われ、アニメーションにより点群が        徐々に整列していきます。このアニメーションは、各点の初期位置から最終的な位置への線形補間（リニアインターポレーション）を計算し、時間の経過とともに更新していきます。</li>
    </ol>

    <h2>補足説明</h2>
    <p>この関数は、3Dビジュアライゼーションにおいて非常に視覚的なインパクトがあり、データの視覚化や教育用ツールとしても利用可能です。また、<code>TWEEN</code> を使ったアニメーションは、スムーズな遷移を実現するための重要な要素です。さらに、ランダムな色の割り当てにより、各点が個別に強調され、視覚的な魅力が増します。</p>
    <p>このコードは、Three.jsとTWEEN.jsのライブラリを前提としています。これらのライブラリは、WebGLを使ったリッチな3Dビジュアライゼーションを簡単に実装するための強力なツールです。Three.jsは3Dオブジェクトの作成と操作を、TWEEN.jsはスムーズなアニメーションの適用を容易にします。</p>

    <h2>まとめ</h2>
    <p>この関数 <code>createWhaleShape</code> は、プログラミングと3Dグラフィックスの知識を組み合わせて、動的でインタラクティブな3Dビジュアルを作成する一例です。XYZデータを基にしたリアルタイムの3D形状変形とアニメーションは、科学的なデータの表示やアートプロジェクトにも応用可能です。</p>
</body>
</html>