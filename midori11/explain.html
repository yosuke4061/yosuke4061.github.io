<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Flat Spiral Rotation Effect 説明</title>
</head>
<body>
    <h1>Flat Spiral Rotation Effect の詳細</h1>
    <p>この関数は、3D空間内で平面螺旋の動きをする立方体とそのトレイル（軌跡）を生成します。</p>

    <h2>立方体の生成</h2>
    <p>立方体のジオメトリとマテリアルを定義し、それを使用して立方体メッシュを作成します。</p>
    <pre><code>const cubeGeometry = new THREE.BoxGeometry(1, 1, 1);
const cubeMaterial = new THREE.MeshBasicMaterial({ color: 0xff0000, transparent: true, opacity: 1.0 });
const cube = new THREE.Mesh(cubeGeometry, cubeMaterial);
scene.add(cube);</code></pre>

    <h2>アニメーションの初期設定</h2>
    <p>アニメーション用の変数を初期化します。これには角度、半径、トレイル配列、トレイルの最大数が含まれます。</p>
    <pre><code>let angle = 0;
let radius = 5;
let trail = [];
let maxTrailCount = 100;</code></pre>

    <h2>立方体の位置更新</h2>
    <p>立方体の位置を更新する関数を定義します。この関数はアニメーションフレームごとに呼び出され、立方体を螺旋状に動かします。</p>
    <pre><code>function updateCubePosition() {
    angle += 0.02;
    cube.position.x = radius * Math.cos(angle);
    cube.position.y = radius * Math.sin(angle);
    cube.position.z = 0;
}</code></pre>

    <h2>トレイルの追加と管理</h2>
    <p>立方体の現在位置にトレイルを追加し、トレイルの数が最大数を超えた場合は古いトレイルを削除します。また、トレイルの透明度を徐々に下げていきます。</p>
    <pre><code>let trailCube = cube.clone();
trailCube.material = cube.material.clone();
trailCube.material.opacity = 0.5;
scene.add(trailCube);
trail.push(trailCube);

if (trail.length > maxTrailCount) {
    let oldTrail = trail.shift();
    scene.remove(oldTrail);
}

trail.forEach(t => {
    t.material.opacity *= 0.95;
});</code></pre>

    <h2>アニメーションの登録</h2>
    <p>立方体の位置を更新する関数を形状配列に追加します。これにより、アニメーションループ内でこの関数が呼び出されるようになります。</p>
    <pre><code>shapes.push({ update: updateCubePosition });</code></pre>
</body>
</html>